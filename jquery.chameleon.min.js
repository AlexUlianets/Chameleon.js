"use strict";!function(o,r,e){var t={content_prefix:"chmln",actions:{COLORIZE:"colorize",GETIMAGECOLORS:"getImageColors",WRAPCOLOR:"wrapColor",COLOROBJECT:"colorObject",SORTCOLORS:"sortColors"},color:{black:{hex:"000000",rgb:{r:0,g:0,b:0}},white:{hex:"ffffff",rgb:{r:255,g:255,b:255}},adapt_limit:200,alpha:200,difference:120,readable_lum_diff:5,readable_alpha:.5,lum_step:.05,default_format:"hex",default_sorting:"primary",default_wrap_color_mode:"tile",default_wrap_arrow_mode:"arrow",default_rules:["container","element"]},canvas:{side:400},limits:{color_rgba:{min:0,max:255},color_alpha:{min:0,max:255},alpha:{min:0,max:1},color_difference:{min:50,max:765},color_adapt_limit:{min:1,max:1e3},canvas_side:{min:50,max:1e4}},sel:{chmln:".chmln"},_sel:{_canvas:"__canvas",_img:"__img",_colors:"__colors",_async_colorize:"_async_colorize",_colorize_done:"_colorize_done"},$:{},tpl:{}},a={skip_validation:!1},l=function(o){return o.slice(1)},n=function(o){return void 0===o},c=function(o,r){return o+parseInt((Math.random()*(r-o)).toFixed(0),10)},i=function(o,r){s()&&chameleonDebug.logger(o,r)},s=function(){return r&&void 0!==r.chameleonDebug},f=function(){return!a.skip_validation&&s()},_=function(o,r,e){if(f()){chameleonDebug.init({_s:t});var l=chameleonDebug.validateSettings(o,r,e);o=l.fixed_settings,l.invalid.length&&i(["Bad settings are fixed!",l.invalid],"warn")}return a.skip_validation=!1,o},m=function(r){var e=(r=r||{}).settings_type||t.actions.COLORIZE,a={};return a[t.actions.COLORIZE]={content_prefix:t.content_prefix,color_format:"hex",color_alpha:t.color.alpha,color_difference:t.color.difference,color_adapt_limit:t.color.adapt_limit,canvas_side:t.canvas.side,debug:!1,async_colorize:!1,apply_colors:!0,adapt_colors:!0,all_colors:!1,insert_colors:!1,data_colors:!1,dummy_back:t.color.white.hex,dummy_front:t.color.black.hex,content:{root:"body",items:[]},rules:{container:{prop:"background-color"},element:{prop:"color"}},afterColorized:function(o,r){},beforeAsyncColorized:function(o){},afterAsyncColorized:function(o){}},a[t.actions.GETIMAGECOLORS]={sort_type:"primary",color_format:"hex",img_src:"",color_alpha:t.color.alpha,color_difference:t.color.difference,canvas_side:t.canvas.side,debug:!1,onGetColorsSuccess:function(o,r,e){},onGetColorsError:function(o,r,e,t,a){}},a[t.actions.WRAPCOLOR]={color_format:"hex",wrap_color_mode:"tile",wrap_arrow_mode:"arrow",color_html:"",source_color_html:"",color:t.color.black.hex,source_color:t.color.white.hex,debug:!1},a[t.actions.COLOROBJECT]={alpha:t.limits.alpha.max,color:t.color.black.hex,debug:!1},a[t.actions.SORTCOLORS]={sort_type:t.color.default_sorting,colors:[],debug:!1},a.hasOwnProperty(e)?o.extend({},a[e],r.settings_values||{}):(i('getDefaultSettings - Unknown settings type given "'+e+'"!',"warn"),{})},u=function(o){if(o&&o.$elem&&o.$elem.length)return n(o.val)||o.$elem.hasClass(l(t.sel.chmln+t._sel._async_colorize))&&o.$elem.attr("data-stopColorize",o.val),o.remove&&o.$elem.removeAttr("data-stopColorize"),o.$elem.attr("data-stopColorize");i("getStopColorize s or s.$elem not given or all $elems are already colorized!","warn")},d=function(o){return t.sel.chmln="."+(o&&o.content_prefix?o.content_prefix:t.content_prefix),t.sel.chmln},h=function(o,r){for(var e in r)r.hasOwnProperty(e)&&o.attr(e,r[e]);return o},p=function(o){var r=[],e=[];for(var t in o)o.hasOwnProperty(t)&&r.push([t,o[t]]);r.sort(function(o,r){return r[1]-o[1]});for(var a=0;a<r.length;a+=1)e[r[a][0]]=r[a][1];return e},g=function(o,r){r=r||2;for(var e=Number(o).toString(16);e.length<r;)e="0"+e;return e},v=function(o){return o?"#"+String(o).replace(/#/g,""):""},w=function(o){return o?((o=String(o).replace(/[^0-9a-f]/gi,"").toLowerCase()).length<6&&(o=o.length>=3?o[0]+o[0]+o[1]+o[1]+o[2]+o[2]:2===o.length?o[0]+o[0]+o[0]+o[1]+o[1]+o[1]:1===o.length?new Array(7).join(o[0]):t.color.black.hex),o.length>6&&(o=o.slice(0,6)),o):""},b=function(){var r=[].slice.apply(arguments),e=t.limits.alpha.max;return o.each(r,function(o,r){if(void 0!==r&&!isNaN(r))return e=r,!1}),e},y=function(o){var r=parseFloat(o.val),e=n(o.max)?t.limits.color_alpha.max:o.max;return isNaN(r)?r=1:r>1?r=(r/(e/100)/100).toFixed(2):r<0&&(r=1),Math.min(1,r)},x=function(r){var e,a,l,n,c,i,s;if("object"==typeof(r=r||{}))if(Array.isArray(r)&&(s=r.slice(),(r={}).color={r:s[0],g:s[1],b:s[2],alpha:s[3]}),"object"==typeof r.color||void 0===r.color){if(Array.isArray(r.color)&&(s=r.color.slice(),r.color={r:s[0],g:s[1],b:s[2],alpha:s[3]}),void 0===r.color){if(void 0===r.r||void 0===r.g||void 0===r.b)return!1;r={color:s=o.extend({},r)}}n=$(r.color.r),c=$(r.color.g),i=$(r.color.b),l=$(b(r.alpha,r.color.alpha,r.color.a,t.limits.color_alpha.max)),a=C([n,c,i,l]).hex}else{if(!(e=O(r.color)).hex)return!1;a=e.hex,l=b(r.alpha,e.alpha),n=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),i=parseInt(a.substr(4,2),16)}else{if(!(e=O(r)).hex)return!1;a=e.hex,l=b(r.alpha,e.alpha),n=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),i=parseInt(a.substr(4,2),16)}var f=Math.max(n,c,i),_=Math.min(n,c,i),m=f,u=f-_,d=0,h=0;return m>0&&(h=u/m)>0&&(n===f?(d=0+(c-_-(i-_))/u*60)<0&&(d+=360):c===f?d=120+(i-_-(n-_))/u*60:i===f&&(d=240+(n-_-(c-_))/u*60)),l=void 0!==l&&l<t.limits.color_alpha.max?0===l?0:y({val:l}):1,{hex:a,r:n,g:c,b:i,alpha:l,chroma:u,hue:d,sat:h,val:m,rgb:"rgb("+n+","+c+","+i+")",rgba:"rgba("+n+","+c+","+i+","+l+")",adjustLum:function(o){return R(this,o)},setAlpha:function(o){return x({color:this,alpha:o})},readable:function(o,r){return o=x(o),r=r||t.limits.color_adapt_limit.max,L(o,r,this)}}},C=function(o){var r="",e=1;if("string"==typeof o){var t=o.split("(");t.length>1&&(M(o)?o=E(o,t[0].trim().toLowerCase()):(r=o,i(["rgbaToHexAlpha - not valid rgb/rgba color!",o],"warn")))}if(Array.isArray(o)){for(var a=0;a<3;a+=1)r+=g(o[a]);n(o[3])||(e=parseFloat(o[3]))}else"object"==typeof o&&(r+=g(o.r)+g(o.g)+g(o.b),n(o.alpha)||(e=parseFloat(o.alpha)));return{hex:w(r),alpha:e}},O=function(o){var r=1;if(o)if(B(o)||F(o)){var e=C(o);o=e.hex,r=e.alpha}else o=w(o);return{hex:o||"",alpha:r}},A=function(o,r){var e=function(o){return.2126*Math.pow(o.r/255,2.2)+.7152*Math.pow(o.g/255,2.2)+.0722*Math.pow(o.b/255,2.2)},t=e(o),a=e(r),l=.05;return t>a?(t+l)/(a+l):(a+l)/(t+l)},R=function(r,e){e=e||0;var a=o.extend({},r),l=a.r,n=a.g,c=a.b;return a.r=Math.round(Math.min(Math.max(0,l+l*e),t.limits.color_rgba.max)),a.g=Math.round(Math.min(Math.max(0,n+n*e),t.limits.color_rgba.max)),a.b=Math.round(Math.min(Math.max(0,c+c*e),t.limits.color_rgba.max)),a=x(a)},k=function(o,r,e,a,l){for(var n=t.color.lum_step,c=1;A(o,r)<t.color.readable_lum_diff&&(c+=1,r=R(r,e*n*c),!(c>a)););return"number"==typeof l&&r.alpha<l&&(r.alpha=l),c>a?x(e>0?t.color.white.hex:t.color.black.hex):r},z=function(r){var e={};"string"==typeof r?e=x(r):"object"==typeof r&&r.back_color?e=r.back_color:"object"==typeof r&&(e=o.extend({},r));var a=x(t.color.black.hex),l=x(t.color.white.hex);return A(e,a)>=t.color.readable_lum_diff?a:l},L=function(r,e,a){var l=o.extend({},a),n=1;return A(r,a)<t.color.readable_lum_diff&&(A(r,x(t.color.black.hex))>=t.color.readable_lum_diff&&(n=-1),l=k(r,a,n,e,t.color.readable_alpha)),l},E=function(o,r){var e={hex:function(o){return/^#([0-9a-f]{3,6})$/i.exec(v(o).toLowerCase())},rgba:function(o){var r=/rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d+)?(?:\.)?\d+)\)/i.exec(o);return!!(r&&r.length>4)&&r.slice(1,5)},rgb:function(o){var r=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})(?:,\s*(?:\d+)?(?:\.)?\d+)?\)/i.exec(o);return!!(r&&r.length>3)&&r.slice(1,4)}};return e.hasOwnProperty(r)?e[r](o):(i(['parseColorStr - unknown format of color "'+o+'"!',r],"warn"),!1)},M=function(o){var r=D(o)||t.color.default_format,e=E(o,r);return"hex"===r?null!==e:!!e&&S(e)},S=function(r){var e=!0;if(o.each(r,function(o,r){if(!T(r))return e=!1,!1}),!e){var t=!r.filter(function(o){return isNaN(parseFloat(o))}).length;e=(3===r.length||4===r.length)&&t}return e},I=function(o){var r=!0;return T(o.r)&&T(o.g)&&T(o.b)&&T(o.alpha||t.limits.color_alpha.max)||(r=!1),r||(r=!n(o.r)&&!n(o.g)&&!n(o.b)),r},$=function(o){return o=parseFloat(o),o=isNaN(o)?t.limits.color_rgba.min:Math.max(t.limits.color_rgba.min,Math.min(t.limits.color_rgba.max,o))},G=function(r){if(r){return function(){return!n(r.color)}()?function(r){var e=o.extend(r,{color:Z({color:r.color,format:D(r.color)})});return r.source_color&&(e=o.extend(e,{source_color:Z({color:r.source_color,format:D(r.source_color)})})),e}(r):Z({color:r,format:D(r)})}return t.color.black.hex},j=function(o){var r=!0;return"string"==typeof o?r=M(o):Array.isArray(o)?r=S(o):"object"==typeof o&&(r=I(o)),r},T=function(o){o=parseFloat(o);var r=!0;return isNaN(o)?r=!1:(o<t.limits.color_rgba.min||o>t.limits.color_rgba.max)&&(r=!1),r},N=function(o){return"string"==typeof o&&""!==o&&("#"===o.charAt(0)||o.length<7&&!/(\[|\]|\{|\}|%)/.test(o))},P=function(o,r){return-1!==["rgb","rgba"].indexOf(r)?"string"==typeof o?""!==o&&0===o.toLowerCase().indexOf(r):Array.isArray(o)?S(o):"object"==typeof o?I(o):(i(["isColorRGBorRGBA - Unknown type of value!",o],"warn"),!1):(i(['isColorRGBorRGBA - Unknown type "'+r+'"!'],"warn"),!1)},B=function(o){return P(o,"rgba")},F=function(o){return P(o,"rgb")},D=function(r){var e=[{format:"hex",check:N},{format:"rgba",check:B},{format:"rgb",check:F}],a=t.color.default_format;return o.each(e,function(o,e){if(e.check(r))return a=e.format,!1}),a},Z=function(o){(o=o||{}).format=o.format||t.color.default_format,"string"==typeof o.color&&(o.color=x(o));var r={hex:function(o){return v(o.hex)},rgb:function(o){return o.rgb},rgba:function(o){return o.rgba}};return r.hasOwnProperty(o.format)?r[o.format](o.color):(i('getColorString - unknown format "'+o.format+'"!',"warn"),"")},U=function(r,e,a){if(r){var l="object"==typeof a,c=l?a[0]:t.color.default_format,i=!1,s=t.color.default_wrap_color_mode,f=t.color.default_wrap_arrow_mode;if(j(c)&&(c=t.color.default_format,i=a[0]),l&&a.length>1&&(i=a[0],c=a[1]||t.color.default_format,a.length>2&&(s=a[2]||t.color.default_wrap_color_mode,a.length>3&&(f=a[3]||t.color.default_wrap_arrow_mode))),"object"==typeof r){if(Array.isArray(r)){var _=null;return j(r)?_=U(x(r),e,a):o.each(r,function(r,t){t=o.extend({},{color_format:c},"object"==typeof t?o.extend({},t):{color:t});var l=U(t,e,a);_=null===_?l:_.add(l)}),_}r.color||(r={color:r,source_color:i,color_format:c,wrap_color_mode:s,wrap_arrow_mode:f})}else"string"==typeof r&&(r={color:r,source_color:i,color_format:c,wrap_color_mode:s,wrap_arrow_mode:f});if(r.color=x(r.color),r.source_color=x(r.source_color),r.color_format=r.color_format||t.color.default_format,r.wrap_color_mode=r.wrap_color_mode||t.color.default_wrap_color_mode,r.wrap_arrow_mode=r.wrap_arrow_mode||t.color.default_wrap_arrow_mode,r.color_html=r.color_html||!1,r.source_color_html=r.source_color_html||!1,r.color){var m=o('<div class="chmln__colors-elem-wrapper">'),u=o('<span class="chmln__colors-elem">'),d=o('<span class="chmln__colors-elem _source">'),h=o('<span class="chmln__colors-arrow">'),p=r.source_color.hex&&(r.source_color.hex!==r.color.hex||r.source_color.alpha!==r.color.alpha),g=function(o){var r=Z({color:o.color,format:o.format});if(r){o.html=o.html||"::color::",o.html=o.html.replace("::color::",r);var e={};o.wrap_arrow_mode?(o.$elem.addClass("_"+o.wrap_arrow_mode),"gradient"===o.wrap_arrow_mode&&"tile"===o.wrap_color_mode&&o.$elem.css({color:"transparent","background-image":"linear-gradient(to right, "+v(o.source_color.hex)+", "+v(r)+")"})):("tile"===o.wrap_color_mode&&"rgba"===o.format&&!n(o.color.alpha)&&o.color.alpha<1&&(o.html='<span class="chmln__colors-elem-text">'+o.html+'</span><div class="chmln__colors-elem-overlay" style="opacity: '+(1-o.color.alpha)+';"></div>',r=v(o.color.hex),o.color=o.color.alpha>t.color.readable_alpha?o.color:t.color.white.hex),"tile"===o.wrap_color_mode?e={"background-color":r,color:v(z(o.color).hex)}:"text"===o.wrap_color_mode&&(e={color:r})),o.$elem.css(e).html(o.html)}};return g({$elem:u,color:r.color,html:r.color_html,format:r.color_format,wrap_color_mode:r.wrap_color_mode}),p&&(g({$elem:d,color:r.source_color,html:r.source_color_html,format:r.color_format,wrap_color_mode:r.wrap_color_mode}),g({$elem:h,color:r.color,source_color:r.source_color,format:r.color_format,wrap_color_mode:r.wrap_color_mode,wrap_arrow_mode:r.wrap_arrow_mode,html:"&#8594"}),u.addClass("_adapted"),d.append(h),m.append(d)),m.append(u).addClass("_"+r.wrap_color_mode).addClass("_"+r.wrap_arrow_mode),m}}},J=function(o){if(o){Array.isArray(o)&&(o={colors:o.slice()}),o.sort_type=o.sort_type||t.color.default_sorting;if(-1!==t.allowed_values.sort_type.indexOf(o.sort_type)&&o.colors&&o.colors.length)return function(o,r){return"primary"===o?r:r.sort(function(r,e){return n(r[o])&&(r=x(r)),n(e[o])&&(e=x(e)),r[o]-e[o]})}(o.sort_type,o.colors.slice());o.colors&&o.colors.length?i('sortColors - Unknown sort type "'+o.sort_type+'".',"warn"):i("sortColors - No colors given!","warn")}return[]},W=function(r){var e=Math.max(r.w,r.h),t=o.extend({},r);return e>r.side&&(e===r.h?(t.w=r.w*(r.side/r.h),t.h=r.side):(t.h=r.h*(r.side/r.w),t.w=r.side)),t},V=function(r,e,a,n,c){var i=o("<img>");i.on({load:function(i){var s=i.target,f=W({w:s.width,h:s.height,side:a.canvas_side}),_=h(o("<canvas>"),{class:l(t.sel.chmln+t._sel._canvas),style:"display: none;",width:f.w,height:f.h});r.append(_);var m=_[0].getContext("2d"),u=[];m.clearRect(0,0,f.w,f.h),m.drawImage(s,0,0,f.w,f.h);try{for(var d=m.getImageData(0,0,f.w,f.h).data,g="",v=0;v<d.length;v+=4)d[v+3]>0&&d[v+3]>=a.color_alpha&&(u[g=d[v]+","+d[v+1]+","+d[v+2]+","+d[v+3]]?u[g]+=1:u[g]=1);var w=p(u),b=[];u=[];for(var y in w)if(w.hasOwnProperty(y)){for(var O=y.split(","),A=!0,R=0;R<b.length;R+=1){for(var k=0,z=b[R].split(","),L=0;L<3;L+=1)k+=Math.abs(O[L]-z[L]);if(k<=a.color_difference){A=!1;break}}A&&(b.push(y),u.push(x({color:C(O).hex,alpha:O[3]})))}a.sort_type&&(u=J({sort_type:a.sort_type,colors:u})),n(u,r,a)}catch(o){c([],o,r,a,e)}_.remove()},error:function(o){c([],o,r,a,e)}}),i.attr("crossOrigin","anonymous").attr("src",e)},H=function(r,e,a){var n=r||[],c=[];if(n.length){var i=[],s=e[0]||x(a.dummy_back),f=1,_=n.find(t.sel.chmln+f);for(c.push(s);_.length>0;)i.push(_),f+=1,_=n.find(t.sel.chmln+f);for(;e.length<f;)e.push(x(a.dummy_front));if(a.adapt_colors){var m=e.slice(1,f).map(L.bind(this,s,a.color_adapt_limit));c=c.concat(m)}else for(var u=1;u<f;u+=1)c.push(e[u]);if(a.apply_colors){var d=function(r,t,a,l,n){n=n||"color",r&&("function"==typeof r?r(t,a,l,e):"object"==typeof r?Array.isArray(r)?o.each(r,function(o,r){d(r,t,a,l)}):t.css(r.prop||n,a.rgba):t.css(n,a.rgba))};d(a.rules.container,n,s,0,"background-color");for(var p=0;p<i.length;p+=1){d(a.rules.element,i[p],c[p+1],p+1);for(var g in a.rules)-1===t.color.default_rules.indexOf(g)&&a.rules.hasOwnProperty(g)&&i[p].filter(g).length&&d(a.rules[g],i[p].filter(g),c[p+1],p+1)}}if(a.insert_colors){var v=n.find(t.sel.chmln+t._sel._colors);v.length?v.html(""):(v=o('<div class="'+l(t.sel.chmln+t._sel._colors)+'">'),n.append(v)),o.each(e,function(o,r){0===o?v.append(U({color:s,color_format:a.color_format})):c[o]?v.append(U({color:c[o],source_color:r,color_format:a.color_format})):a.all_colors&&v.append(U({color:r,color_format:a.color_format}))})}a.all_colors&&(c=c.concat(e.slice(c.length))),a.data_colors&&h(n,{"data-colors":c.map(function(o){return Z({color:o,format:a.color_format})})}),n.addClass(l(t.sel.chmln+t._sel._colorize_done))}return c},Q=function(r,e){r=o.extend({},m(),r);var a=function(){var e=o(this),a=o.extend({},r,{$img:e.find(t.sel.chmln+t._sel._img).first()});a.$img.length?V(e,a.$img[0].src,a,function(o,r,e){var t=H(r,o,e);"function"==typeof e.afterColorized&&e.afterColorized(t,e)},function(o,r,e,t,a){"function"==typeof t.afterColorized&&t.afterColorized(o,t),i(['Failed to load image with url "'+a+'".',r],"error")}):i("Image not found. Each individual material must contain at least one image.","error")};if((e=function(r,e){var a=!1;if(!e.length)if(r.content){var l=r.content_prefix,n=0,c=o(r.content.root),s=function(r){return o("<div>").append(r).children()},f=function(o){var r=!1;if(o.length){var e=function(o){return _({elem:o})};r=s(o.map(e))}return r},_=function(r){(r=r||{}).elem=o.extend({},{tag:"div",class:"",content:"",ignore:!1,children:[]},r.elem),r.type=r.type||"element";var e=["img"];switch(r.type){case"container":r.elem.class+=" "+l;break;case"element":r.elem.ignore||-1!==e.indexOf(r.elem.tag)||(n+=1,r.elem.class+=" "+l+n),"img"===r.elem.tag&&r.elem.main_img&&(r.elem.class+=" "+l+t._sel._img);break;default:i([t.actions.COLORIZE+"/renderElements/renderElem - unknown elem type!",r.type],"warn")}var a=o("<"+r.elem.tag+">");return a.addClass(r.elem.class||""),a.html(r.elem.content||""),a.append(f(r.elem.children)),r.elem.src&&"img"===r.elem.tag&&a.attr("src",r.elem.src).attr("alt",r.elem.alt||"Chameleon image"),r.elem.id&&a.attr("id",r.elem.id),a},m=function(r){var e;if("string"==typeof r){var a=(e=o(r)).attr("data-content_prefix");if(a&&a!==l){e.addClass(l),e.find("."+a+t._sel._img).addClass(l+t._sel._img);for(var c=1,i=e.find("."+a+c);i.length;)i.addClass(l+c),i=e.find("."+a+c),c+=1}}else(e=_({elem:r.container,type:"container"})).append(f(r.elements));return n=0,e};c.length&&r.content.items&&r.content.items.length?(e=s(r.content.items.map(m)),c.append(e)):a=!0}else a=!0;return a&&i("No $elements found.","warn"),e}(r,e)).removeClass(l(t.sel.chmln+t._sel._colorize_done)).toggleClass(l(t.sel.chmln+t._sel._async_colorize),!!r.async_colorize),r.async_colorize){var c=function(r){var e=!1;return r.length&&(e=r.splice(0,1)[0]),o(e)},s=function(o){o&&o.length&&(n(u({$elem:o}))?(a.call(o),(o=c(e)).length?setTimeout(s.bind(null,o),0):"function"==typeof r.afterAsyncColorized&&r.afterAsyncColorized(r)):u({$elem:o,val:"",remove:!0}))};"function"==typeof r.beforeAsyncColorized&&r.beforeAsyncColorized(r),s(c(e))}else e.each(a);return e},q=function(r,e){var a=function(){var e=o(this);r=o.extend({},m({settings_type:t.actions.GETIMAGECOLORS,settings_values:{$img:e}}),r),"img"===e[0].nodeName.toLowerCase()?V(e.parent(),e.attr("src"),r,r.onGetColorsSuccess,r.onGetColorsError):i('Given element is not "img"!',"error")};e.each(a),e.length||r.img_src&&(r=o.extend({},m({settings_type:t.actions.GETIMAGECOLORS}),r),V(o("body"),r.img_src,r,r.onGetColorsSuccess,r.onGetColorsError))},K={stopColorize:function(o,r){var e=r.filter(":not("+t.sel.chmln+t._sel._colorize_done+")");e.length&&u({$elem:e,val:1})},decolorize:function(r,e){r=o.extend({},m(),r),o.each(e,function(){var e=o(this),a=1,l=e.find("."+r.content_prefix+a),n=function(r,e){"function"==typeof e?e(r,null,null,null,function(r,e){var t={};o.each(e,function(o,r){t[r]=""}),r.css(t)}):Array.isArray(e)?o.each(e,function(o,e){n(r,e)}):"object"==typeof e&&r.css(e.prop,"")};for(n(e,r.rules.container),e.removeClass(r.content_prefix+t._sel._colorize_done).removeClass(r.content_prefix+t._sel._async_colorize).find("."+r.content_prefix+t._sel._canvas).remove();l.length;)n(l,r.rules.element),l=e.find("."+r.content_prefix+a),a+=1;for(var c in r.rules)-1===t.color.default_rules.indexOf(c)&&r.rules.hasOwnProperty(c)&&(l=e.find(c)).length&&l.each(function(e,t){n(o(t),r.rules[c])})})},get_s:{result:function(){return o.extend({},t)}},skipValidation:{result:function(){return a.skip_validation=!0,o.fn.chameleon}},getDefaultSettings:{result:m},isColorValid:{result:j},fixColor:{result:G},getRandomColor:{result:function(){var o=t.limits.color_rgba.min,r=t.limits.color_rgba.max;return x([c(o,r),c(o,r),c(o,r),c(o,r)])}},whiteOrBlack:{result:z}};K[t.actions.COLORIZE]=Q,K[t.actions.GETIMAGECOLORS]=q,K[t.actions.WRAPCOLOR]={result:U},K[t.actions.COLOROBJECT]={result:x},K[t.actions.SORTCOLORS]={result:J},t.allowed_values={settings_type:[t.actions.COLORIZE,t.actions.GETIMAGECOLORS,t.actions.WRAPCOLOR,t.actions.COLOROBJECT,t.actions.SORTCOLORS],wrap_color_mode:["tile","text"],wrap_arrow_mode:["arrow","gradient"],sort_type:["primary","hue","sat","val","chroma","alpha"],color_format:["hex","rgb","rgba"]},t.can_be_empty=["source_color","alpha","img_src","color_html","source_color_html"],t.settings_dependencies={wrap_arrow_mode:{depend:[{val:"gradient",prop:"wrap_color_mode",prop_val:["tile"]}]}},o.fn.chameleon=function(r,e){var a=o(this),l="string"==typeof r,n=[].slice.call(arguments,l?2:1);if(e=l?e:r,r=l?r:t.actions.COLORIZE,e=_(e,r,n),d(e),K.hasOwnProperty(r)){if(K[r].result&&"function"==typeof K[r].result)return K[r].result(e,a,n);K[r](e,a,n)}else i(["Unknown action!",r],"error");return this}}(jQuery,window);